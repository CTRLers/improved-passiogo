require 'test_helper'

RSpec.describe 'User Account Deletion and Driver/User Functionality', type: :request do
  let!(:user) { create(:user, role: 'user') }  # Regular user
  let!(:driver) { create(:user, role: 'driver') }  # Driver

  # Test for Driver-specific functionality
  describe 'Driver-specific functionality' do
    context 'when a driver is signed in' do
      it 'allows a driver to access the driver dashboard' do
        sign_in driver  # Assuming you use Devise for authentication
        get driver_dashboard_path  # Replace with the correct path to your driver dashboard
        expect(response).to have_http_status(:ok)  # Or :success, depending on your setup
      end
    end

    context 'when a regular user is signed in' do
      it 'does not allow a regular user to access the driver dashboard' do
        sign_in user  # Sign in as regular user
        get driver_dashboard_path  # Replace with the correct path to your driver dashboard
        expect(response).to redirect_to(root_path)  # Redirecting regular user to the home page (or a proper restricted page)
        expect(flash[:alert]).to eq("Access denied. Only drivers can access this page.")  # Optional: Customize the flash message
      end
    end
  end
end
